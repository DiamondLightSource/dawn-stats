<!DOCTYPE html>
<meta charset="utf-8">
<link href="css/nv.d3.min.css" rel="stylesheet" type="text/css">
<style>

body {
  overflow-y:scroll;
}

text {
  font: 12px sans-serif;
}

.mypiechart {
  width: 500px;
  border: 2px;
}
</style>
<body class='with-3d-shadow with-transitions'>
<table style="width:1000">
	<tr>
		<td><center>Java version</center></td>
		<td><center>Region</center></td>
		<td><center>Operating system</center></td>
	</tr>
		<td><svg id="java" class="mypiechart"></svg></td>
		<td><svg id="geo" class="mypiechart"></svg></td>
		<td><svg id="os" class="mypiechart"></svg></td>
	</tr>
</table>

<script src="js/d3/d3.v3.min.js"></script>
<script src="js/nvd3/nv.d3.min.js"></script>
<script src="js/nvd3/legend.js"></script>
<script src="js/nvd3/pie.js"></script>
<script src="js/nvd3/pieChart.js"></script>
<script src="js/nvd3/utils.js"></script>
<script>
d3.json("http://diamweb01.diamond.ac.uk/dawnstats/download.php?type=java", function(error, data) {
nv.addGraph(function() {
    var width = 500,
        height = 500;

    var chart = nv.models.pieChart()
        .x(function(d) { return d.key })
        .y(function(d) { return d.y })
        .color(d3.scale.category10().range())
        .width(width)
        .height(height);

      d3.select("#java")
          .datum(data)
        .transition().duration(1200)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

    chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });

    return chart;
});
});

d3.json("http://diamweb01.diamond.ac.uk/dawnstats/download.php?type=geo", function(error, data) {
nv.addGraph(function() {

    var width = 500,
        height = 500;

    var chart = nv.models.pieChart()
        .x(function(d) { return d.key })
        .y(function(d) { return d.y })
        //.labelThreshold(.08)
        //.showLabels(false)
        .color(d3.scale.category10().range())
        .width(width)
        .height(height)
        .donut(true)
		.donutRatio(0.35);

  //  chart.pie
   //     .startAngle(function(d) { return d.startAngle/2 -Math.PI/2 })
    //    .endAngle(function(d) { return d.endAngle/2 -Math.PI/2 });

      //chart.pie.donutLabelsOutside(true).donut(true);

      d3.select("#geo")
          //.datum(historicalBarChart)
          .datum(data)
        .transition().duration(1200)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

    return chart;
});
});

d3.json("http://diamweb01.diamond.ac.uk/dawnstats/download.php?type=os", function(error, data) {
nv.addGraph(function() {
    var width = 500,
        height = 500;

    var chart = nv.models.pieChart()
        .x(function(d) { return d.key })
        .y(function(d) { return d.y })
        .color(d3.scale.category10().range())
        .width(width)
        .height(height);

      d3.select("#os")
          .datum(data)
        .transition().duration(1200)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

    chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });

    return chart;
});
});
</script>
